<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="loadmodule" content="Base.Administrator.Login" error="admin/index.html" />
<meta name="loadmodule" content="Shop.Summery.RepeaterOrder" title="order_type,:CASE WHEN :order_repeat: > 1 THEN 1 ELSE 0 END:order_repeat:" summery="subtotal,total" result="orders" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>端末分析結果 - Sweetberry 管理画面</title>
<!--{include file="common/site_header.phtml"}-->
<!-- 棒グラフ用のプラグイン -->
<script type="text/javascript" src="/js/plugins/jqplot.barRenderer.min.js"></script>
<script type="text/javascript" src="/js/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="/js/plugins/jqplot.pointLabels.min.js"></script>
</head>
<body>
<!--{include file="common/header.phtml"}-->

<div id="result">
<!--{assign var="total" value="0"}-->
<!--{foreach from=$ATTRIBUTES.orders item="order"}-->
<!--{assign var="totalCount" value=$totalCount+$order->count}-->
<!--{assign var="totalPrice" value=$totalPrice+$order->subtotal}-->
<!--{assign var="average" value=$order->subtotal/$order->count}-->
<!--{assign var="totalAverage" value=$totalAverage+$average}-->
<!--{/foreach}-->
<table id="result_table">
<thead>
<tr><th>端末種別</th><th>購入種別</th><th>受注件数</th><th>受注比率</th><th>購入合計金額</th><th>購入合計比率</th><th>購入平均金額</th><th>購入平均比率</th></tr>
</thead>
<tbody>
<!--{foreach from=$ATTRIBUTES.orders item="order"}-->
<tr>
<th><!--{$order->order_type|escape}--></th>
<th><!--{if $order->order_repeat > 0}-->リピート<!--{else}-->新規購入<!--{/if}--></th>
<td><!--{$order->count|number_format}--></td>
<td><!--{$order->count/$totalCount*100|number_format}-->%</td>
<td><!--{$order->subtotal|number_format}--></td>
<td><!--{$order->subtotal/$totalPrice*100|number_format}-->%</td>
<!--{assign var="average" value=$order->subtotal/$order->count}-->
<td><!--{$average|number_format}--></td>
<td><!--{$average/$totalAverage*100|number_format}-->%</td>
</tr>
<!--{/foreach}-->
</tbody>
</table>
</div>

<!--{assign var="count" value=$ATTRIBUTES.orders|count}-->
<div id="order_count" style="width: <!--{$count*100+150}-->px"></div>
<div id="order_total" style="width: <!--{$count*100+150}-->px"></div>
<div id="order_average" style="width: <!--{$count*100+150}-->px"></div>

<script type="text/javascript">
barChart(
	"order_count", 
	"注文件数分析", 
	[{label:"新規購入"},{label:"リピート"}], 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
		<!--{if $index == 0 || $order->order_type != $ATTRIBUTES.orders[$index - 1]->order_type}-->
		<!--{if $index > 0}-->,<!--{/if}-->
		"<!--{$order->order_type}-->"
		<!--{/if}-->
	<!--{/foreach}-->], 
	"%d件", 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
	<!--{if $order->order_repeat == 0}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[<!--{$order->count}-->,<!--{if $order->order_type == $ATTRIBUTES.orders[$index + 1]->order_type}--><!--{$ATTRIBUTES.orders[$index + 1]->count}--><!--{else}-->0<!--{/if}-->]
	<!--{elseif $index == 0 || $order->order_type != $ATTRIBUTES.orders[$index - 1]->order_type}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[0,<!--{$order->count}-->]
	<!--{/if}-->
	<!--{/foreach}-->]
);
barChart(
	"order_total", 
	"購入金額分析", 
	[{label:"新規購入"},{label:"リピート"}], 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
		<!--{if $index == 0 || $order->order_type != $ATTRIBUTES.orders[$index - 1]->order_type}-->
		<!--{if $index > 0}-->,<!--{/if}-->
		"<!--{$order->order_type}-->"
		<!--{/if}-->
	<!--{/foreach}-->], 
	"%d円", 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
	<!--{if $order->order_repeat == 0}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[<!--{$order->subtotal}-->,<!--{if $order->order_type == $ATTRIBUTES.orders[$index + 1]->order_type}--><!--{$ATTRIBUTES.orders[$index + 1]->subtotal}--><!--{else}-->0<!--{/if}-->]
	<!--{elseif $index == 0 || $order->order_type != $ATTRIBUTES.orders[$index - 1]->order_type}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[0,<!--{$order->subtotal}-->]
	<!--{/if}-->
	<!--{/foreach}-->]
);
barChart(
	"order_average", 
	"購入平均分析", 
	[{label:"新規購入"},{label:"リピート"}], 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
		<!--{if $index == 0 || $order->order_type != $ATTRIBUTES.orders[$index - 1]->order_type}-->
		<!--{if $index > 0}-->,<!--{/if}-->
		"<!--{$order->order_type}-->"
		<!--{/if}-->
	<!--{/foreach}-->], 
	"%d円", 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
	<!--{if $order->order_repeat == 0}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[<!--{$order->subtotal/$order->count}-->,<!--{if $order->order_type == $ATTRIBUTES.orders[$index + 1]->order_type}--><!--{$ATTRIBUTES.orders[$index + 1]->subtotal/$ATTRIBUTES.orders[$index + 1]->count}--><!--{else}-->0<!--{/if}-->]
	<!--{elseif $index == 0 || $order->order_type != $ATTRIBUTES.orders[$index - 1]->order_type}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[0,<!--{$order->subtotal/$order->count}-->]
	<!--{/if}-->
	<!--{/foreach}-->]
);
</script>

<!--{include file="common/footer.phtml"}-->
</body>
</html>