<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="loadmodule" content="Base.Administrator.Login" error="admin/index.html" />
<meta name="loadmodule" content="Shop.Summery.RepeaterOrderPayment" title="payment_id,:CASE WHEN :order_repeat: > 1 THEN 1 ELSE 0 END:order_repeat:" summery="payment_total" result="orders" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>決済方法分析結果 - Sweetberry 管理画面</title>
<!--{include file="common/site_header.phtml"}-->
<!-- 棒グラフ用のプラグイン -->
<script type="text/javascript" src="/js/plugins/jqplot.barRenderer.min.js"></script>
<script type="text/javascript" src="/js/plugins/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="/js/plugins/jqplot.pointLabels.min.js"></script>
</head>
<body>
<!--{include file="common/header.phtml"}-->

<div id="result">
<!--{assign var="total" value="0"}-->
<!--{foreach from=$ATTRIBUTES.orders item="order"}-->
<!--{assign var="totalCount" value=$totalCount+$order->count}-->
<!--{assign var="totalPrice" value=$totalPrice+$order->payment_total}-->
<!--{assign var="average" value=$order->payment_total/$order->count}-->
<!--{assign var="totalAverage" value=$totalAverage+$average}-->
<!--{/foreach}-->
<table id="result_table">
<thead>
<tr><th>決済方法</th><th>受注区分</th><th>注文回数</th><th>注文回数比率</th><th>支払金額合計</th><th>支払金額比率</th><th>支払平均合計</th><th>支払平均比率</th></tr>
</thead>
<tbody>
<!--{foreach from=$ATTRIBUTES.orders item="order"}-->
<tr>
<th><!--{$order->payment()->payment_name}--></th>
<th><!--{if $order->order_repeat > 0}-->リピート<!--{else}-->新規購入<!--{/if}--></th>
<td><!--{$order->count|number_format}--></td>
<td><!--{$order->count/$totalCount*100|number_format}-->%</td>
<td><!--{$order->payment_total|number_format}--></td>
<td><!--{$order->payment_total/$totalPrice*100|number_format}-->%</td>
<!--{assign var="average" value=$order->payment_total/$order->count}-->
<td><!--{$average|number_format}--></td>
<td><!--{$average/$totalAverage*100|number_format}-->%</td>
</tr>
<!--{/foreach}-->
</tbody>
</table>
</div>

<!--{assign var="count" value=$ATTRIBUTES.orders|count}-->
<div id="order_count" style="width: <!--{$count*200+150}-->px"></div>
<div id="order_total" style="width: <!--{$count*200+150}-->px"></div>
<div id="order_average" style="width: <!--{$count*200+150}-->px"></div>



<script type="text/javascript">
barChart(
	"order_count", 
	"販売数量分析", 
	[{label:"新規購入"},{label:"リピート"}], 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
		<!--{if $index == 0 || $order->payment_id != $ATTRIBUTES.orders[$index - 1]->payment_id}-->
		<!--{if $index > 0}-->,<!--{/if}-->
		"<!--{$order->payment()->payment_name}-->"
		<!--{/if}-->
	<!--{/foreach}-->], 
	"%d件", 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
	<!--{if $order->order_repeat == 0}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[<!--{$order->count}-->,<!--{if $order->payment_id == $ATTRIBUTES.orders[$index + 1]->payment_id}--><!--{$ATTRIBUTES.orders[$index + 1]->count}--><!--{else}-->0<!--{/if}-->]
	<!--{elseif $index == 0 || $order->payment_id != $ATTRIBUTES.orders[$index - 1]->payment_id}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[0,<!--{$order->count}-->]
	<!--{/if}-->
	<!--{/foreach}-->]
);
barChart(
	"order_total", 
	"販売金額分析", 
	[{label:"新規購入"},{label:"リピート"}], 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
		<!--{if $index == 0 || $order->payment_id != $ATTRIBUTES.orders[$index - 1]->payment_id}-->
		<!--{if $index > 0}-->,<!--{/if}-->
		"<!--{$order->payment()->payment_name}-->"
		<!--{/if}-->
	<!--{/foreach}-->], 
	"%d円", 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
	<!--{if $order->order_repeat == 0}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[<!--{$order->payment_total}-->,<!--{if $order->payment_id == $ATTRIBUTES.orders[$index + 1]->payment_id}--><!--{$ATTRIBUTES.orders[$index + 1]->payment_total}--><!--{else}-->0<!--{/if}-->]
	<!--{elseif $index == 0 || $order->payment_id != $ATTRIBUTES.orders[$index - 1]->payment_id}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[0,<!--{$order->payment_total}-->]
	<!--{/if}-->
	<!--{/foreach}-->]
);
barChart(
	"order_average", 
	"販売単価分析", 
	[{label:"新規購入"},{label:"リピート"}], 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
		<!--{if $index == 0 || $order->payment_id != $ATTRIBUTES.orders[$index - 1]->payment_id}-->
		<!--{if $index > 0}-->,<!--{/if}-->
		"<!--{$order->payment()->payment_name}-->"
		<!--{/if}-->
	<!--{/foreach}-->], 
	"%d円", 
	[<!--{foreach from=$ATTRIBUTES.orders key="index" item="order"}-->
	<!--{if $order->order_repeat == 0}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[<!--{$order->payment_total/$order->count}-->,<!--{if $order->payment_id == $ATTRIBUTES.orders[$index + 1]->payment_id}--><!--{$ATTRIBUTES.orders[$index + 1]->payment_total/$ATTRIBUTES.orders[$index + 1]->count}--><!--{else}-->0<!--{/if}-->]
	<!--{elseif $index == 0 || $order->payment_id != $ATTRIBUTES.orders[$index - 1]->payment_id}-->
	<!--{if $index > 0}-->,<!--{/if}-->
	[0,<!--{$order->payment_total/$order->count}-->]
	<!--{/if}-->
	<!--{/foreach}-->]
);
</script>

<!--{include file="common/footer.phtml"}-->
</body>
</html>